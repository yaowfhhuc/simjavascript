/*!
 * JavaScript Sim Framework V1.0
 * http://code.google.com/p/simjavascript/
 *
 * Copyright 2010, Peyton Peng
 * licensed under the LGPL version 3 license.
 * http://www.gnu.org/licenses/lgpl.html
 *
 * Date: Mon May 30 23:35:23 2011 +0800
 */
var Sim={auther:"Peyton Peng",email:"smtd5@126.com",version:"1.0"};var SimUtil={_cache:{srcs:0,domReady:0,count:0},uniqueNum:function(){return new Date().getTime()+(SimUtil._cache.count++)},attachEvent:window.addEventListener?function(c,a,b){if(c.addEventListener){b=SimUtil.asFunc(b);c.addEventListener(a,b,false);return b}}:function(c,a,b){if(c.attachEvent){b=SimUtil.asFunc(b);c.attachEvent("on"+a,b);return b}},removeEvent:document.removeEventListener?function(c,a,b){if(c.removeEventListener){c.removeEventListener(a,b,false)}}:function(c,a,b){if(c.detachEvent){c.detachEvent("on"+a,b)}},asFunc:function(func){return(typeof(func)=="function")?func:function(){eval(func)}},onload:function(a){SimUtil.delegate(function(){if(!document.body||!SimUtil._cache.domReady||SimUtil._cache.srcs){SimUtil.onload(a)}else{SimUtil.delegate(a)}},10)},include:function(a){SimUtil._cache.srcs||(SimUtil._cache.srcs={});if(!(a in SimUtil._cache.srcs)){SimUtil._cache.srcs[a]=""}},extend:function(d,c,a){if(c){for(var b in c){if((!d[b])&&(b!="cType")&&(b!="eType")){d.prototype[b]=c[b]}}if(!a){if(d!=String){d.prototype.toString=c.toString}d.prototype.parentClass=c}}return d},extendAll:function(c,b){if(b){for(var a in b){c.prototype[a]=b[a]}}return c},config:function(c,b){if((null!=c)&&(typeof(b)=="object")){for(var a in b){c[a]=b[a]}}return c},hash:function(d){d=""+d;var c=0,f=0;var a=d.length;for(var b=0;b<a;b++){c=31*c+d.charCodeAt(f++)}while(c>2147483647){c%=429567296}return c},delegate:function(a,b){b=b||1;return setTimeout(a,b)},regGlobalVar:function(b,a){window[b]=a;return window[b]},regClassProto:function(clsName){try{return SimUtil.regGlobalVar("$_"+clsName.substring(0,1).toLowerCase()+clsName.substring(1),eval("new "+clsName+"()"))}catch(e){alert(e.message)}}};SimUtil.on=SimUtil.attachEvent;(function(){if(document.addEventListener){document.addEventListener("DOMContentLoaded",function(){document.removeEventListener("DOMContentLoaded",arguments.callee,false);SimUtil._cache.domReady=true},false)}else{document.onreadystatechange=function(){if(this.readyState=="complete"){SimUtil._cache.domReady=true;document.onreadystatechange=null}}}var _include=function(){if(!SimUtil._cache.domReady){SimUtil.delegate(_include,10)}else{try{with(document.getElementsByTagName("head")[0]){for(var url in SimUtil._cache.srcs){var el=document.createElement("script");el.setAttribute("type","text/javascript");el.setAttribute("src",url);appendChild(el)}}SimUtil._cache.srcs=null}catch(e){}}};_include()})();Sim.Ajax=function(c){var g=false;try{if(window.ActiveXObject){for(var b=5;b;b--){try{if(b==2){g=new ActiveXObject("Microsoft.XMLHTTP")}else{g=new ActiveXObject("Msxml2.XMLHTTP."+b+".0");g.setRequestHeader("Content-Type","application/x-www-form-urlencoded");g.setRequestHeader("Charset","UTF-8")}break}catch(f){g=false}}}else{if(window.XMLHttpRequest){g=new XMLHttpRequest();if(g.overrideMimeType){g.overrideMimeType("application/x-www-form-urlencoded")}}}}catch(f){g=false}var h=null;var d=null;if(c.params){h="";for(var a in c.params){h+=("&"+a+"="+c.params[a])}h=h.substring(1)}if(!c.nocache){if(h){h+="&token="+new Date()}else{h="token="+new Date()}}if(h&&!c.method||c.method=="GET"){if(c.url.indexOf("?")){d="?"+h}else{d="&"+h}h=null}g.open(c.method||"GET",c.url+d,c.async||true);g.send(h);if(c.success||c.error){g.onreadystatechange=function(){if(g.readyState==4){if(g.status==200){c.success.call(this,g.responseText)}else{if(c.error){c.error.call(this,g.responseText)}}}}}};var ConstructorProvider={construct:function(){var a=arguments.length;if(a){this.id=arguments[0]}if(a>1){this.name=arguments[1]}}};var Obj=function(){this.construct.apply(this,arguments)};Obj.prototype.cType="Object";SimUtil.extend(Obj,ConstructorProvider);Obj.prototype.hashCode=function(){return this.hashcode||SimUtil.hash(this.toString())};Obj.prototype.equals=function(a){return a&&(this==a||(a.hashCode&&(this.hashCode()==a.hashCode())))};Obj.prototype.toString=function(){return this.cType+(this.id?(" : "+this.id):"")+" ["+this.hashCode()+"]"};SimUtil.regClassProto("Obj");SimUtil.extend(String,$_obj);String.prototype.cType="String";String.prototype.trim=function(){return this.replace(/^\s+/g,"").replace(/\s+$/g,"")};var Thread=function(){if(arguments.length>2){this.func=arguments[2]}else{if(arguments.length==1&&(typeof arguments[0]=="function")){this.func=arguments[0]}}};Thread.prototype.cType="Thread";Thread.prototype.start=function(){SimUtil.delegate(this.func)};Thread.prototype.regFunc=function(a){this.func=a;return this};SimUtil.extend(Thread,$_obj);var List=function(){this.hashcode=SimUtil.uniqueNum();this.array=[];this.length=0};List.prototype.cType="List";List.prototype.add=function(a){this.array[this.length++]=a;return true};List.prototype.insert=function(c,a){if(a<0||a>this.length){return false}for(var b=this.length;b>a;b--){this.array[b]=this.array[b-1]}this.array[a]=c;this.length++};List.prototype.get=function(a){if(a<0||a>=this.length){return false}return this.array[a]};List.prototype.remove=function(c){if(typeof(c)=="number"){if(c<0||c>=this.length){return false}var a=array[c];for(var b=c;b<this.length-1;b++){this.array[b]=this.array[b+1]}this.array[--this.length]=null;return a}else{for(var b=0;b<length-1;b++){if((c.cType&&c.equals(this.array[b]))||(c==this.array[b])){return this.remove(b)}}return false}};List.prototype.size=function(){return this.length};List.prototype.contains=function(a){for(var b=0;b<this.length;b++){if((a==this.array[b])||(a&&a.cType&&a.equals(this.array[b]))){return true}}return false};SimUtil.extend(List,$_obj);SimUtil.regClassProto("List");var Map=function(){this._map={};this.hashcode=SimUtil.uniqueNum();this.vSize++};Map.prototype.cType="Map";Map.prototype.put=function(b,a){if(!(b in this._map)){this.vSize++}this._map[b]=a;return a};Map.prototype.get=function(a){return this._map[a]};Map.prototype.remove=function(d){var b=this._map[d];if(d in this._map){try{delete (this._map[d])}catch(f){var c={};for(var a in this._map){if(d!=a){c[a]=this._map[a]}}this._map=c}this.vSize--}return b};Map.prototype.contains=function(a){return a in this._map};Map.prototype.containsValue=function(c){var b=false;for(var a in this._map){if(b=(c==this._map[a])){break}}return b};Map.prototype.entries=function(){return this._map};Map.prototype.size=function(){return this.vSize};SimUtil.extend(Map,$_obj);SimUtil.regClassProto("Map");var Set=function(){this.hashcode=SimUtil.uniqueNum();this._container=new Map()};Set.prototype.cType="Set";Set.prototype.add=function(a){this._container.put(a,a)};Set.prototype.remove=function(a){return this._container.remove(a)};Set.prototype.contains=function(a){return this._container.contains(a)};Set.prototype.entries=function(){return this._container.entries()};Set.prototype.size=function(){return this._container.size()};SimUtil.extend(Set,$_obj);SimUtil.regClassProto("Set");var HashMap=function(b){this.hashcode=SimUtil.uniqueNum();this._tableSize=b;this._vSize=0;if(!this._tableSize||this._tableSize<this.DEFAULT_TABLE_SIZE){this._tableSize=this.DEFAULT_TABLE_SIZE}else{while(true){var c=Math.sqrt(this._tableSize);c=parseInt(c);var a=2;for(;a<c;a++){if(c%a==0){this._tableSize--;break}}if(a==c){break}}}this._hashTable[0]=new this.Entry();this._hashTable[0].head=true;for(var a=0;a<this._tableSize;a++){this._hashTable[a+1]=new this.Entry();this._hashTable[a+1].head=true;this._hashTable[a].next=this._hashTable[a+1]}};HashMap.prototype.cType="HashMap";HashMap.prototype.DEFAULT_TABLE_SIZE=7;HashMap.prototype._hashTable=[];HashMap.prototype.Entry=function(b,a){this.key=b;this.value=a;this.next=null;this.nextItem=function(){if(this.next&&this.next.head){return this.next.nextItem()}else{return this.next}};this.isEnd=function(){if(!this.next||this.next.head){return true}else{return false}}};HashMap.prototype.hash=function(a){a*=1000;a%=this._tableSize;return a};HashMap.prototype.hashKey=function(a){return(a&&a.hashCode)?this.hash(a.hashCode()):this._tableSize};HashMap.prototype.put=function(c,b){var d=this.hashKey(c);var g=this._hashTable[d];var a=null;while(!g.isEnd()){g=g.next;if(g&&(c==g.key)||(c.equals&&c.equals(g.key))){g.value=b;a=g;break}}if(!a){var f=new this.Entry(c,b);f.next=g.next;g.next=f;this._vSize++}return a};HashMap.prototype.get=function(b){var c=this.hashKey(b);var a=null;var d=this._hashTable[c];while(!d.isEnd()){d=d.next;if(b==d.key||(b.equals&&b.equals(d.key))){a=d.value;break}}return a};HashMap.prototype.remove=function(b){var c=this.hashKey(b);var a=false;var d=this._hashTable[c];while(!d.isEnd()){if((b.equals&&b.equals(d.next.key))||(b==d.next.key)){a=d.next.value;this._vSize--;d.next=d.next.next;break}d=d.next}return a};HashMap.prototype.contains=function(b){var a=false;if(b!=null){var c=this._hashTable[0].nextItem();while(c){if((c.key==b)||(b.equals&&b.equals(c.key))){a=true;break}c=c.nextItem()}}return a};HashMap.prototype.containsValue=function(b){var a=false;if(b!=null){var c=this._hashTable[0].nextItem();while(c){if((c.value==b)||(b.equals&&b.equals(c.value))){a=true;break}c=c.nextItem()}}return a};HashMap.prototype.iterator=function(){return this._hashTable[0].next};HashMap.prototype.size=function(){return this._vSize};SimUtil.extend(HashMap,$_obj);SimUtil.regClassProto("HashMap");var HashSet=function(a){this.hashcode=SimUtil.uniqueNum();this._container=new HashMap(a||this.DEFAULT_TABLE_SIZE)};HashSet.prototype.cType="HashSet";HashSet.prototype.DEFAULT_TABLE_SIZE=5;HashSet.prototype.add=function(a){this._container.put(a,a)};HashSet.prototype.remove=function(a){return this._container.remove(a)};HashSet.prototype.contains=function(a){return this._container.contains(a)};HashSet.prototype.iterator=function(){return this._container.iterator()};HashSet.prototype.size=function(){return this._container.size()};SimUtil.extend(HashSet,$_obj);SimUtil.regClassProto("HashSet");Sim.DomUtil={funcs:[],bind:function(a,b){this.funcs[this.funcs.length]={t:a,f:SimUtil.attachEvent(this,a,b)};return this},unbind:function(b,c){var d;if(b){if(c){for(var a=this.funcs.length;a>0;){d=this.funcs[--a];if(d.t==b&&d.f==c){SimUtil.removeEvent(this,b,c);this.funcs.splice(a,1)}}}else{for(var a=this.funcs.length;a>0;){d=this.funcs[--a];if(d.t==b){this.unbind(d.t,d.f)}}}}else{for(var a=this.funcs.length;a>0;){d=this.funcs[--a];this.unbind(d.t,d.f)}}return this},add:function(a){this.appendChild(a);return this},remove:function(){if(this.parentNode){this.parentNode.removeChild(this)}return this}};SimUtil.querySelector=function(a){if(document.querySelectorAll){return document.querySelectorAll(a)}else{}};Sim.$=function(a){if(a){a=(a.cType==String.prototype.cType)?document.getElementById(a):a;return SimUtil.config(a,Sim.DomUtil)}};try{if($){}else{$=Sim.$}}catch(e){$=Sim.$}Array.prototype.each=function(b){for(var a=0;a<this.length;a++){b.call(this[a],a)}};Sim.ref={_CLASS_MAP:new Map(),SUB_TYPE:"children",regClass:function(a){if(a&&a.prototype.cType){Sim.ref._CLASS_MAP.put(a.prototype.cType,a)}else{}},_create:function(b){if(Component.isInputType(b)){var a=new Input();a.eType=Component.getEType(b);return a}else{if(Component.isSupportedClass(b)){return SimUI.create(Component.getEType(b),b)}else{return SimUI.create(b,b)}}},build:function(d){if(d&&d.cType){var h=Sim.ref._create(d.cType);for(var a in d){var g=d[a];if(a==Sim.ref.SUB_TYPE&&g&&g.length&&h.add){}else{if(a=="parent"){}else{h[a]=g}}}var c=d[Sim.ref.SUB_TYPE];if(c&&c.length&&h.add){for(var b=0;b<c.length;b++){var j=Sim.ref.build(c[b]);if(j){h.add(j)}}}var f=d.parent;if(f){if(f.cType&&f.eType){f.add(h)}else{f.appendChild(h.element())}}}if(d.id){SimUtil.regGlobalVar(d.id,h)}return h}};var SimUI={fetch:function(d){var a=Sim.$(d);var b=new Component(a.id,a.name);b._vElem=a;return b},create:function(b,a){return SimUtil.config(new Component(),{cType:a,eType:b})},clone:function(a){var d=new Component();d.cType=a.cType;d.eType=a.eType;for(key in a){try{d[key]=a[key]}catch(b){}}d._elem=null;return d}};var Component=function(){this.hashcode=SimUtil.uniqueNum();this.construct.apply(this,arguments);this._vElem=null};Component.prototype.cType="Component";Component._eventsRegex=/^(click|change|mouseover|mouseout|dblclick|blur|focus|load|unload)$/;Component._copyAttrs=function(){try{for(var b in this){if(Component._eventsRegex.test(b)){SimUtil.on(this._vElem,b,this.click)}else{if(b=="parent"){if(!this.parent){}else{if(!this.parent.cType){this.parent.appendChild(this._vElem)}else{this.parent.add(this._vElem)}}}else{if(b=="value"){if(this.cType=="Button"){this._vElem.innerText=this[b];this._vElem.textContent=this[b]}}else{if(b!="cType"&&b!="eType"&&b!="_vElem"&&this[b]&&typeof(this[b])!="function"){this._vElem[b]=this[b];try{this._vElem.setAttribute(b,this[b])}catch(c){}}if(b=="innerText"){this._vElem.innerText=this.innerText;this._vElem.textContent=this.innerText}}}}}}catch(a){alert(a.message+" "+this.eType+" don't support the type:"+b)}};Component.prototype.element=function(){if(!this._vElem){this._vElem=document.createElement(this.eType);this._vElem.value=this.value;this._vElem.id=this.id||SimUtil.uniqueNum();Component._copyAttrs.apply(this,arguments);Sim.$(this._vElem)}return this._vElem};Component.prototype.add=function(a){if(!a.cType&&!this._vElem){this.element().appendChild(a)}else{this.element().appendChild(a.element())}};Component.prototype.setStyle=function(a){this.element().className=a};Component.prototype.getStyle=function(a){return this.element().className};Component.prototype.addStyle=function(a){this.element().className+=a};Component.prototype.removeStyle=function(a){var b=this.element().className||"";while(b.indexOf(a)>=0){b.replace(a,"")}this.element().className=b.trim()};Component.prototype.removeAll=function(){this.element().innerHTML=""};Component.prototype.css=function(a,b){try{this.element().style[a]=b}catch(c){}};Component.prototype.setContent=function(a){try{this.element().innerText=a;this.element().textContent=a}catch(b){}};Component.prototype.get=function(a){return this.element()[a]||this.element().getAttribute(a)};Component.prototype.set=function(b,c){try{this.element()[b]=c;this.element().setAttribute(b,c)}catch(a){}};Component.prototype.funcs=[];Component.prototype.bind=function(a,b){this.element().bind(a,b);return this};Component.prototype.unbind=function(a,b){this.element().unbind(a,b);return this};SimUtil.extend(Component,$_obj);SimUtil.regClassProto("Component");var CompDataUtil={_nonValueElements:{Div:"div",Span:"span",Label:"label",Table:"table",Tbody:"tbody",Thead:"thead",Th:"th",Tr:"tr",Td:"td",Br:"br"},_valueElements:{Select:"select",Option:"option",Button:"button",Textarea:"textarea",Input:"input"},_inputElements:{TextField:"text",RadioButton:"radio",IButton:"button",SubmitButton:"submit",ResetButton:"rest",PasswordField:"password",Checkbox:"checkbox",File:"file"}};Component.isInputType=function(a){return a in CompDataUtil._inputElements};Component.isSupportedClass=function(a){return(a in CompDataUtil._nonValueElements)||(a in CompDataUtil._valueElements)||(a in CompDataUtil._inputElements)};Component.getEType=function(a){return CompDataUtil._nonValueElements[a]||CompDataUtil._valueElements[a]||CompDataUtil._inputElements[a]};for(var key in CompDataUtil){var isInput=(key=="_inputElements");var elements=CompDataUtil[key];for(var clsName in elements){var eType=elements[clsName];SimUtil.extendAll(SimUtil.extend(SimUtil.regGlobalVar(clsName,(key=="_nonValueElements")?function(){this.hashcode=SimUtil.uniqueNum();this.construct.apply(this,arguments);if(arguments.length>2){if(arguments[3]){this.innerHTML=arguments[2]}else{this.appendChild(document.createTextNode(arguments[2]))}}}:function(){this.hashcode=SimUtil.uniqueNum();this.construct.apply(this,arguments);if(arguments.length>2){this.value=arguments[2]}}),isInput?$_input:$_component),{cType:clsName,eType:eType});SimUtil.regClassProto(clsName)}}Select.prototype.add=function(a){if(!a.cType&&!this._vElem){this.element().options.add(a)}else{this.element().options.add(a.element())}};Select.prototype.remove=function(a){if(!a.cType&&!this._vElem){this.element().options.remove(a)}else{this.element().options.remove(a.element())}};Input.prototype.element=function(){if(!this._vElem){if(window.ActiveXObject){this._vElem=document.createElement('<input type="'+this.eType+'" name="'+this.name+'" />')}else{this._vElem=document.createElement("input");this._vElem.type=this.eType;this._vElem.name=this.name}if(this.value){try{this._vElem.value=this.value}catch(a){}}this._vElem.id=this.id;Component._copyAttrs.apply(this,arguments);Sim.$(this._vElem)}return this._vElem};